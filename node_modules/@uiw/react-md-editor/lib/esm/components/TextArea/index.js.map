{"version":3,"sources":["../../../../src/components/TextArea/index.tsx"],"names":["React","useEffect","useImperativeHandle","useState","classnames","Prism","hotkeys","forwardRef","props","ref","prefixCls","className","onChange","onMount","onScroll","tabSize","style","otherProps","warp","createRef","preElm","textElm","text","current","value","setValue","highlight","pre","html","languages","markdown","innerHTML","autoFocus","focus","bind","e","target"],"mappings":"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","sourcesContent":["import React, { useEffect, useImperativeHandle, useMemo, useState } from 'react';\nimport classnames from 'classnames';\nimport Prism from 'prismjs';\nimport 'prismjs/components/prism-markdown.js';\nimport { IProps } from '../../utils';\nimport hotkeys, { IHotkeyOptions } from './hotkeys';\nimport './index.less';\n\nexport interface ITextAreaProps\n  extends Omit<React.TextareaHTMLAttributes<HTMLTextAreaElement>, 'value' | 'onChange' | 'onScroll'>,\n    IProps {\n  onChange?: (event: React.ChangeEvent<HTMLTextAreaElement>) => void;\n  onMount?: (isMount: boolean) => void;\n  onScroll?: (e: React.UIEvent<HTMLDivElement>) => void;\n  value?: string;\n  tabSize?: number;\n}\n\nexport type TextAreaRef = {\n  text?: HTMLTextAreaElement;\n  warp?: HTMLDivElement;\n};\n\nexport default React.forwardRef<TextAreaRef, ITextAreaProps>((props, ref) => {\n  const { prefixCls, className, onChange, onMount, onScroll, tabSize, style, ...otherProps } = props || {};\n  const warp = React.createRef<HTMLDivElement>();\n  const preElm = React.createRef<HTMLPreElement>();\n  const textElm = React.createRef<HTMLTextAreaElement>();\n  useImperativeHandle<TextAreaRef, {}>(ref, () => ({ text: textElm.current, warp: warp.current }), [\n    warp.current,\n    textElm.current,\n  ]);\n  const [value, setValue] = useState(props.value);\n  const highlight = () => {\n    const pre = preElm.current;\n    const html = Prism.highlight(value as string, Prism.languages.markdown, 'markdown');\n    pre!.innerHTML = `${html}<br />`;\n  };\n  useEffect(() => {\n    onMount && onMount(true);\n    return () => {\n      onMount && onMount(false);\n    };\n  }, []);\n  useEffect(() => {\n    if (props.value !== value) {\n      setValue(props.value);\n    }\n  }, [props.value]);\n\n  useEffect(() => highlight(), [value]);\n  useEffect(() => {\n    if (props.autoFocus && textElm.current) {\n      textElm.current.focus();\n    }\n  }, [props.autoFocus]);\n  return (\n    <div ref={warp} className={classnames(`${prefixCls}-aree`, className)} onScroll={onScroll}>\n      <div className={classnames(`${prefixCls}-text`)}>\n        <pre ref={preElm} className={classnames(`${prefixCls}-text-pre`, 'wmde-markdown-color')} />\n        <textarea\n          {...otherProps}\n          ref={textElm}\n          onKeyDown={hotkeys.bind(this, { tabSize } as IHotkeyOptions)}\n          className={`${prefixCls}-text-input`}\n          value={value}\n          onChange={(e) => {\n            setValue(e.target.value);\n            onChange && onChange(e);\n          }}\n        />\n      </div>\n    </div>\n  );\n});\n"]}