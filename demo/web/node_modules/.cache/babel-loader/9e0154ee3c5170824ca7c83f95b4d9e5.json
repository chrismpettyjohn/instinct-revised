{"ast":null,"code":"import _regeneratorRuntime from\"/Users/cpettyjohn/Habbo/instinct-revised/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/cpettyjohn/Habbo/instinct-revised/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"/Users/cpettyjohn/Habbo/instinct-revised/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/cpettyjohn/Habbo/instinct-revised/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/cpettyjohn/Habbo/instinct-revised/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useLocation}from'wouter';import{toast}from'react-toastify';import{Icon}from'../../generic/icon';import{Loading}from'../../generic/loading';import ReCAPTCHA from'react-google-recaptcha';import{Form,Input}from'../../generic/form';import React,{useContext,useState}from'react';import{userService}from'../../../services/user';import{configContext}from'../../../context/config';import{sessionContext}from'../../../context/session';import{sessionService}from'../../../services/session';import{ModalButton}from'../../generic/modal/modal-button';import{defaultRegisterModalState}from'./';export function RegisterModal(){var _useContext=useContext(configContext),config=_useContext.config;// eslint-disable-next-line @typescript-eslint/no-unused-vars\nvar _useLocation=useLocation(),_useLocation2=_slicedToArray(_useLocation,2),location=_useLocation2[0],setLocation=_useLocation2[1];var _useState=useState(defaultRegisterModalState),_useState2=_slicedToArray(_useState,2),state=_useState2[0],setState=_useState2[1];var _useContext2=useContext(sessionContext),setUser=_useContext2.setUser;var disabled=state.username===''||state.password===''||state.email===''||state.password!==state.passwordAgain;function setValue(key,value){setState(_objectSpread(_objectSpread({},state),{},_defineProperty({},key,value)));}function tryRegister(){return _tryRegister.apply(this,arguments);}function _tryRegister(){_tryRegister=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var bearer,user;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setValue('showSpinner',true);_context.next=4;return userService.create(state.username,state.password,state.email,state.captcha);case 4:_context.next=6;return sessionService.attemptCredentials(state.username,state.password);case 6:bearer=_context.sent;_context.next=9;return sessionService.attemptBearerToken(bearer);case 9:user=_context.sent;_context.next=12;return setUser(user);case 12:setLocation('/me');_context.next=19;break;case 15:_context.prev=15;_context.t0=_context[\"catch\"](0);toast.error('There was a problem creating your account.');setValue('showSpinner',false);case 19:case\"end\":return _context.stop();}}},_callee,null,[[0,15]]);}));return _tryRegister.apply(this,arguments);}return/*#__PURE__*/React.createElement(ModalButton,{button:\"Register\",className:\"mr-2\",header:\"Create an Account\"},/*#__PURE__*/React.createElement(Loading,{isLoading:state.showSpinner,text:\"Creating your account...\"},/*#__PURE__*/React.createElement(Form,{className:\"login-form\",onSubmit:tryRegister},/*#__PURE__*/React.createElement(\"label\",{className:\"username-input\"},/*#__PURE__*/React.createElement(Input,{name:\"username\",placeholder:\"Username\",value:state.username,onChange:setValue,type:\"text\"}),/*#__PURE__*/React.createElement(Icon,{type:\"user\"})),/*#__PURE__*/React.createElement(\"label\",{className:\"username-input\"},/*#__PURE__*/React.createElement(Input,{name:\"email\",placeholder:\"Email\",value:state.email,onChange:setValue,type:\"email\"}),/*#__PURE__*/React.createElement(Icon,{type:\"envelope\"})),/*#__PURE__*/React.createElement(\"label\",{className:\"password-input\"},/*#__PURE__*/React.createElement(Input,{name:\"password\",placeholder:\"Password\",value:state.password,onChange:setValue,type:\"password\"}),/*#__PURE__*/React.createElement(Icon,{type:\"lock\"})),/*#__PURE__*/React.createElement(\"label\",{className:\"password-input\"},/*#__PURE__*/React.createElement(Input,{name:\"passwordAgain\",placeholder:\"Password Again\",value:state.passwordAgain,onChange:setValue,type:\"password\"}),/*#__PURE__*/React.createElement(Icon,{type:\"lock\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"row mt-2 mb-2\"},/*#__PURE__*/React.createElement(ReCAPTCHA,{sitekey:config.googleRecaptchaClientKey,onChange:function onChange(x){return setValue('captcha',x);}})),/*#__PURE__*/React.createElement(\"button\",{className:\"rounded-button blue plain\",disabled:disabled,type:\"submit\"},\"Create Account\"))));}","map":{"version":3,"sources":["/Users/cpettyjohn/Habbo/instinct-revised/packages/frontend/frontend/src/components/template/register-modal/RegisterModal.tsx"],"names":["useLocation","toast","Icon","Loading","ReCAPTCHA","Form","Input","React","useContext","useState","userService","configContext","sessionContext","sessionService","ModalButton","defaultRegisterModalState","RegisterModal","config","location","setLocation","state","setState","setUser","disabled","username","password","email","passwordAgain","setValue","key","value","tryRegister","create","captcha","attemptCredentials","bearer","attemptBearerToken","user","error","showSpinner","googleRecaptchaClientKey","x"],"mappings":"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","sourcesContent":["import {useLocation} from 'wouter';\nimport {toast} from 'react-toastify';\nimport {Icon} from '../../generic/icon';\nimport {Loading} from '../../generic/loading';\nimport ReCAPTCHA from 'react-google-recaptcha';\nimport {Form, Input} from '../../generic/form';\nimport React, {useContext, useState} from 'react';\nimport {userService} from '../../../services/user';\nimport {configContext} from '../../../context/config';\nimport {sessionContext} from '../../../context/session';\nimport {sessionService} from '../../../services/session';\nimport {ModalButton} from '../../generic/modal/modal-button';\nimport {RegisterModalState, defaultRegisterModalState} from './';\n\nexport function RegisterModal() {\n  const {config} = useContext(configContext);\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const [location, setLocation] = useLocation();\n  const [state, setState] = useState<RegisterModalState>(\n    defaultRegisterModalState\n  );\n  const {setUser} = useContext(sessionContext);\n\n  const disabled: boolean =\n    state.username === '' ||\n    state.password === '' ||\n    state.email === '' ||\n    state.password !== state.passwordAgain;\n\n  function setValue<T extends keyof RegisterModalState>(\n    key: T,\n    value: RegisterModalState[T]\n  ): void {\n    setState({\n      ...state,\n      [key]: value,\n    });\n  }\n\n  async function tryRegister(): Promise<void> {\n    try {\n      setValue('showSpinner', true);\n      await userService.create(\n        state.username,\n        state.password,\n        state.email,\n        state.captcha\n      );\n      const bearer = await sessionService.attemptCredentials(\n        state.username,\n        state.password\n      );\n      const user = await sessionService.attemptBearerToken(bearer);\n      await setUser(user);\n      setLocation('/me');\n    } catch {\n      toast.error('There was a problem creating your account.');\n      setValue('showSpinner', false);\n    }\n  }\n\n  return (\n    <ModalButton button=\"Register\" className=\"mr-2\" header=\"Create an Account\">\n      <Loading isLoading={state.showSpinner} text=\"Creating your account...\">\n        <Form className=\"login-form\" onSubmit={tryRegister}>\n          <label className=\"username-input\">\n            <Input\n              name=\"username\"\n              placeholder=\"Username\"\n              value={state.username}\n              onChange={setValue}\n              type=\"text\"\n            />\n            <Icon type=\"user\" />\n          </label>\n          <label className=\"username-input\">\n            <Input\n              name=\"email\"\n              placeholder=\"Email\"\n              value={state.email}\n              onChange={setValue}\n              type=\"email\"\n            />\n            <Icon type=\"envelope\" />\n          </label>\n          <label className=\"password-input\">\n            <Input\n              name=\"password\"\n              placeholder=\"Password\"\n              value={state.password}\n              onChange={setValue}\n              type=\"password\"\n            />\n            <Icon type=\"lock\" />\n          </label>\n          <label className=\"password-input\">\n            <Input\n              name=\"passwordAgain\"\n              placeholder=\"Password Again\"\n              value={state.passwordAgain}\n              onChange={setValue}\n              type=\"password\"\n            />\n            <Icon type=\"lock\" />\n          </label>\n          <div className=\"row mt-2 mb-2\">\n            <ReCAPTCHA\n              sitekey={config.googleRecaptchaClientKey}\n              onChange={x => setValue('captcha', x as string)}\n            />\n          </div>\n          <button\n            className=\"rounded-button blue plain\"\n            disabled={disabled}\n            type=\"submit\"\n          >\n            Create Account\n          </button>\n        </Form>\n      </Loading>\n    </ModalButton>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}