{"ast":null,"code":"import _regeneratorRuntime from\"/Users/cpettyjohn/Habbo/instinct-revised/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/cpettyjohn/Habbo/instinct-revised/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"/Users/cpettyjohn/Habbo/instinct-revised/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/cpettyjohn/Habbo/instinct-revised/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/cpettyjohn/Habbo/instinct-revised/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{toast}from'react-toastify';import{websiteSettingsContext}from'./WebsiteSettings';import React,{useEffect,useState}from'react';import{configService,useFetchFullConfig}from'@instinct-prj/frontend';import{defaultWebsiteSettingsContextState}from'./WebsiteSettings.types';export function WebsiteSettingsProvider(_ref){var children=_ref.children;var defaultConfig=useFetchFullConfig();var _useState=useState(defaultWebsiteSettingsContextState),_useState2=_slicedToArray(_useState,2),state=_useState2[0],setState=_useState2[1];useEffect(function(){if(defaultConfig!==undefined){setState(function(_){return _objectSpread(_objectSpread({},_),{},{config:defaultConfig});});}},[defaultConfig]);if(defaultConfig===undefined){return/*#__PURE__*/React.createElement(\"i\",{className:\"fa fa-spinner fa-spin\"});}function setConfig(key,value){setState(function(_){return _objectSpread(_objectSpread({},_),{},{config:_objectSpread(_objectSpread({},_.config),{},_defineProperty({},key,value))});});}function saveChanges(){return _saveChanges.apply(this,arguments);}function _saveChanges(){_saveChanges=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setState(function(_){return _objectSpread(_objectSpread({},_),{},{showError:false,showSpinner:true});});_context.prev=1;_context.next=4;return configService.updateConfig(state.config);case 4:toast.success('Website settings have been updated');setState(function(_){return _objectSpread(_objectSpread({},_),{},{showSpinner:false});});_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);setState(function(_){return _objectSpread(_objectSpread({},_),{},{showError:true,showSpinner:false});});case 11:case\"end\":return _context.stop();}}},_callee,null,[[1,8]]);}));return _saveChanges.apply(this,arguments);}var Provider=websiteSettingsContext.Provider;return/*#__PURE__*/React.createElement(Provider,{value:_objectSpread(_objectSpread({},state),{},{setConfig:setConfig,saveChanges:saveChanges})},state.showError&&/*#__PURE__*/React.createElement(\"div\",{className:\"alert alert-danger\"},/*#__PURE__*/React.createElement(\"i\",{className:\"fa fa-exclamation-triangle mr-2\"}),/*#__PURE__*/React.createElement(\"span\",null,\"Your changes could not be saved\")),children);}","map":{"version":3,"sources":["/Users/cpettyjohn/Habbo/instinct-revised/packages/frontend/admin/src/website/context/WebsiteSettings.provider.tsx"],"names":["toast","websiteSettingsContext","React","useEffect","useState","configService","useFetchFullConfig","defaultWebsiteSettingsContextState","WebsiteSettingsProvider","children","defaultConfig","state","setState","undefined","_","config","setConfig","key","value","saveChanges","showError","showSpinner","updateConfig","success","Provider"],"mappings":"yxBAAA,OAAQA,KAAR,KAAoB,gBAApB,CACA,OAAQC,sBAAR,KAAqC,mBAArC,CACA,MAAOC,CAAAA,KAAP,EAA6BC,SAA7B,CAAwCC,QAAxC,KAAuD,OAAvD,CACA,OAAQC,aAAR,CAAuBC,kBAAvB,KAAgD,wBAAhD,CACA,OACEC,kCADF,KAGO,yBAHP,CAMA,MAAO,SAASC,CAAAA,uBAAT,MAAuE,IAArCC,CAAAA,QAAqC,MAArCA,QAAqC,CAC5E,GAAMC,CAAAA,aAAa,CAAGJ,kBAAkB,EAAxC,CAD4E,cAElDF,QAAQ,CAChCG,kCADgC,CAF0C,wCAErEI,KAFqE,eAE9DC,QAF8D,eAM5ET,SAAS,CAAC,UAAM,CACd,GAAIO,aAAa,GAAKG,SAAtB,CAAiC,CAC/BD,QAAQ,CAAC,SAAAE,CAAC,wCACLA,CADK,MAERC,MAAM,CAAEL,aAFA,IAAF,CAAR,CAID,CACF,CAPQ,CAON,CAACA,aAAD,CAPM,CAAT,CASA,GAAIA,aAAa,GAAKG,SAAtB,CAAiC,CAC/B,mBAAO,yBAAG,SAAS,CAAC,uBAAb,EAAP,CACD,CAED,QAASG,CAAAA,SAAT,CACEC,GADF,CAEEC,KAFF,CAGQ,CACNN,QAAQ,CAAC,SAAAE,CAAC,wCACLA,CADK,MAERC,MAAM,gCACDD,CAAC,CAACC,MADD,wBAEHE,GAFG,CAEGC,KAFH,EAFE,IAAF,CAAR,CAOD,CA9B2E,QAgC7DC,CAAAA,WAhC6D,2IAgC5E,mIACEP,QAAQ,CAAC,SAAAE,CAAC,wCACLA,CADK,MAERM,SAAS,CAAE,KAFH,CAGRC,WAAW,CAAE,IAHL,IAAF,CAAR,CADF,sCAQUhB,CAAAA,aAAa,CAACiB,YAAd,CAA2BX,KAAK,CAACI,MAAjC,CARV,QASIf,KAAK,CAACuB,OAAN,CAAc,oCAAd,EACAX,QAAQ,CAAC,SAAAE,CAAC,wCAASA,CAAT,MAAYO,WAAW,CAAE,KAAzB,IAAF,CAAR,CAVJ,+EAYIT,QAAQ,CAAC,SAAAE,CAAC,wCACLA,CADK,MAERM,SAAS,CAAE,IAFH,CAGRC,WAAW,CAAE,KAHL,IAAF,CAAR,CAZJ,oEAhC4E,8CAoD5E,GAAMG,CAAAA,QAAQ,CAAGvB,sBAAsB,CAACuB,QAAxC,CAEA,mBACE,oBAAC,QAAD,EAAU,KAAK,gCAAMb,KAAN,MAAaK,SAAS,CAATA,SAAb,CAAwBG,WAAW,CAAXA,WAAxB,EAAf,EACGR,KAAK,CAACS,SAAN,eACC,2BAAK,SAAS,CAAC,oBAAf,eACE,yBAAG,SAAS,CAAC,iCAAb,EADF,cAEE,kEAFF,CAFJ,CAOGX,QAPH,CADF,CAWD","sourcesContent":["import {toast} from 'react-toastify';\nimport {websiteSettingsContext} from './WebsiteSettings';\nimport React, {ReactElement, useEffect, useState} from 'react';\nimport {configService, useFetchFullConfig} from '@instinct-prj/frontend';\nimport {\n  defaultWebsiteSettingsContextState,\n  WebsiteSettingsContextState,\n} from './WebsiteSettings.types';\nimport {ConfigDTO} from '@instinct-prj/interface';\n\nexport function WebsiteSettingsProvider({children}: {children: ReactElement}) {\n  const defaultConfig = useFetchFullConfig();\n  const [state, setState] = useState<WebsiteSettingsContextState>(\n    defaultWebsiteSettingsContextState\n  );\n\n  useEffect(() => {\n    if (defaultConfig !== undefined) {\n      setState(_ => ({\n        ..._,\n        config: defaultConfig,\n      }));\n    }\n  }, [defaultConfig]);\n\n  if (defaultConfig === undefined) {\n    return <i className=\"fa fa-spinner fa-spin\" />;\n  }\n\n  function setConfig<K extends keyof ConfigDTO>(\n    key: K,\n    value: ConfigDTO[K]\n  ): void {\n    setState(_ => ({\n      ..._,\n      config: {\n        ..._.config,\n        [key]: value,\n      },\n    }));\n  }\n\n  async function saveChanges(): Promise<void> {\n    setState(_ => ({\n      ..._,\n      showError: false,\n      showSpinner: true,\n    }));\n\n    try {\n      await configService.updateConfig(state.config);\n      toast.success('Website settings have been updated');\n      setState(_ => ({..._, showSpinner: false}));\n    } catch {\n      setState(_ => ({\n        ..._,\n        showError: true,\n        showSpinner: false,\n      }));\n    }\n  }\n\n  const Provider = websiteSettingsContext.Provider;\n\n  return (\n    <Provider value={{...state, setConfig, saveChanges}}>\n      {state.showError && (\n        <div className=\"alert alert-danger\">\n          <i className=\"fa fa-exclamation-triangle mr-2\" />\n          <span>Your changes could not be saved</span>\n        </div>\n      )}\n      {children}\n    </Provider>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}