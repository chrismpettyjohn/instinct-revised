{"ast":null,"code":"import _regeneratorRuntime from\"/Users/cpettyjohn/Habbo/instinct/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/cpettyjohn/Habbo/instinct/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/cpettyjohn/Habbo/instinct/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/cpettyjohn/Habbo/instinct/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import{backendAPI,setAPIToken}from'../../api';import{localStorageService}from'../../services/local-storage';var SessionServiceImplementation=/*#__PURE__*/function(){function SessionServiceImplementation(){var _this=this;_classCallCheck(this,SessionServiceImplementation);this.localStorageKey='session';this.logout=function(){localStorageService.delete(_this.localStorageKey);};}_createClass(SessionServiceImplementation,[{key:\"init\",value:function(){var _init=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var authToken;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;authToken=localStorageService.get(this.localStorageKey);_context.next=4;return this.attemptBearerToken(authToken);case 4:return _context.abrupt(\"return\",_context.sent);case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);return _context.abrupt(\"return\",undefined);case 10:case\"end\":return _context.stop();}}},_callee,this,[[0,7]]);}));function init(){return _init.apply(this,arguments);}return init;}()},{key:\"attemptCredentials\",value:function(){var _attemptCredentials=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(username,password){var bearerToken;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return backendAPI.post('session',{username:username,password:password});case 2:bearerToken=_context2.sent;return _context2.abrupt(\"return\",bearerToken.data);case 4:case\"end\":return _context2.stop();}}},_callee2);}));function attemptCredentials(_x,_x2){return _attemptCredentials.apply(this,arguments);}return attemptCredentials;}()},{key:\"attemptBearerToken\",value:function(){var _attemptBearerToken=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(bearerToken){var session;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;this.setBearerToken(bearerToken);_context3.next=4;return backendAPI.get('session');case 4:session=_context3.sent;return _context3.abrupt(\"return\",session.data);case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);setAPIToken();throw new Error('Invalid bearer token');case 12:case\"end\":return _context3.stop();}}},_callee3,this,[[0,8]]);}));function attemptBearerToken(_x3){return _attemptBearerToken.apply(this,arguments);}return attemptBearerToken;}()},{key:\"setBearerToken\",value:function setBearerToken(bearerToken){setAPIToken(bearerToken);return bearerToken!==undefined?localStorageService.set(this.localStorageKey,bearerToken):localStorageService.delete(this.localStorageKey);}},{key:\"createSSO\",value:function(){var _createSSO=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var sso;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return backendAPI.post('session/sso');case 2:sso=_context4.sent;return _context4.abrupt(\"return\",sso.data);case 4:case\"end\":return _context4.stop();}}},_callee4);}));function createSSO(){return _createSSO.apply(this,arguments);}return createSSO;}()},{key:\"getCurrentUser\",value:function(){var _getCurrentUser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var user;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;_context5.next=3;return backendAPI.get('session');case 3:user=_context5.sent;return _context5.abrupt(\"return\",user.data);case 7:_context5.prev=7;_context5.t0=_context5[\"catch\"](0);throw new Error('Not Authenticated');case 10:case\"end\":return _context5.stop();}}},_callee5,null,[[0,7]]);}));function getCurrentUser(){return _getCurrentUser.apply(this,arguments);}return getCurrentUser;}()},{key:\"updateProfile\",value:function(){var _updateProfile=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(favoriteYoutubeVideo){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return backendAPI.post('session/settings/preferences',{favoriteYoutubeVideo:favoriteYoutubeVideo});case 2:case\"end\":return _context6.stop();}}},_callee6);}));function updateProfile(_x4){return _updateProfile.apply(this,arguments);}return updateProfile;}()},{key:\"updateEmail\",value:function(){var _updateEmail=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(currentPassword,newEmail){return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.next=2;return backendAPI.post('session/settings/email',{password:currentPassword,email:newEmail});case 2:case\"end\":return _context7.stop();}}},_callee7);}));function updateEmail(_x5,_x6){return _updateEmail.apply(this,arguments);}return updateEmail;}()},{key:\"updatePassword\",value:function(){var _updatePassword=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(currentPassword,newPassword,newPasswordAgain){return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.next=2;return backendAPI.post('session/settings/password',{oldPassword:currentPassword,newPassword:newPassword,newPasswordAgain:newPasswordAgain});case 2:case\"end\":return _context8.stop();}}},_callee8);}));function updatePassword(_x7,_x8,_x9){return _updatePassword.apply(this,arguments);}return updatePassword;}()},{key:\"generateForgotPasswordToken\",value:function(){var _generateForgotPasswordToken=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(email){return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_context9.next=2;return backendAPI.post(\"session/forgot-password?email=\".concat(email));case 2:case\"end\":return _context9.stop();}}},_callee9);}));function generateForgotPasswordToken(_x10){return _generateForgotPasswordToken.apply(this,arguments);}return generateForgotPasswordToken;}()},{key:\"redeemForgotPasswordToken\",value:function(){var _redeemForgotPasswordToken=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(token,newPassword,newPasswordAgain){return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:_context10.next=2;return backendAPI.post('session/forgot-password/redeem',{token:token,password:newPassword,passwordAgain:newPasswordAgain});case 2:case\"end\":return _context10.stop();}}},_callee10);}));function redeemForgotPasswordToken(_x11,_x12,_x13){return _redeemForgotPasswordToken.apply(this,arguments);}return redeemForgotPasswordToken;}()}]);return SessionServiceImplementation;}();export var sessionService=new SessionServiceImplementation();","map":{"version":3,"sources":["/Users/cpettyjohn/Habbo/instinct/packages/frontend/frontend/src/services/session/Session.ts"],"names":["backendAPI","setAPIToken","localStorageService","SessionServiceImplementation","localStorageKey","logout","delete","authToken","get","attemptBearerToken","undefined","username","password","post","bearerToken","data","setBearerToken","session","Error","set","sso","user","favoriteYoutubeVideo","currentPassword","newEmail","email","newPassword","newPasswordAgain","oldPassword","token","passwordAgain","sessionService"],"mappings":"ulBAGA,OAAQA,UAAR,CAAoBC,WAApB,KAAsC,WAAtC,CACA,OAAQC,mBAAR,KAAkC,8BAAlC,C,GAEMC,CAAAA,4B,wIACKC,e,CAAkB,S,MAuD3BC,M,CAAS,UAAM,CACbH,mBAAmB,CAACI,MAApB,CAA2B,KAAI,CAACF,eAAhC,EACD,C,6SArDSG,S,CAAoBL,mBAAmB,CAACM,GAApB,CAAwB,KAAKJ,eAA7B,C,uBACb,MAAKK,kBAAL,CAAwBF,SAAxB,C,+IAENG,S,2RAKTC,Q,CACAC,Q,6JAEiDZ,CAAAA,UAAU,CAACa,IAAX,CAC/C,SAD+C,CAE/C,CAACF,QAAQ,CAARA,QAAD,CAAWC,QAAQ,CAARA,QAAX,CAF+C,C,QAA3CE,W,iDAICA,WAAW,CAACC,I,+TAGID,W,mJAErB,KAAKE,cAAL,CAAoBF,WAApB,E,uBAC2Cd,CAAAA,UAAU,CAACQ,GAAX,CAAe,SAAf,C,QAArCS,O,iDACCA,OAAO,CAACF,I,6DAEfd,WAAW,G,KACL,IAAIiB,CAAAA,KAAJ,CAAU,sBAAV,C,gPAIKJ,W,CAA2B,CACxCb,WAAW,CAACa,WAAD,CAAX,CAEA,MAAOA,CAAAA,WAAW,GAAKJ,SAAhB,CACHR,mBAAmB,CAACiB,GAApB,CAAwB,KAAKf,eAA7B,CAA8CU,WAA9C,CADG,CAEHZ,mBAAmB,CAACI,MAApB,CAA2B,KAAKF,eAAhC,CAFJ,CAGD,C,kRAG0CJ,CAAAA,UAAU,CAACa,IAAX,CAAgB,aAAhB,C,QAAnCO,G,iDACCA,GAAG,CAACL,I,6bAK+Bf,CAAAA,UAAU,CAACQ,GAAX,CAAe,SAAf,C,QAAlCa,I,iDACCA,IAAI,CAACN,I,kEAEN,IAAIG,CAAAA,KAAJ,CAAU,mBAAV,C,gTAQUI,oB,6IACZtB,CAAAA,UAAU,CAACa,IAAX,CAAgB,8BAAhB,CAAgD,CACpDS,oBAAoB,CAApBA,oBADoD,CAAhD,C,8RAKUC,e,CAAyBC,Q,6IACnCxB,CAAAA,UAAU,CAACa,IAAX,CAAgB,wBAAhB,CAA0C,CAC9CD,QAAQ,CAAEW,eADoC,CAE9CE,KAAK,CAAED,QAFuC,CAA1C,C,kSAOND,e,CACAG,W,CACAC,gB,6IAEM3B,CAAAA,UAAU,CAACa,IAAX,CAAgB,2BAAhB,CAA6C,CACjDe,WAAW,CAAEL,eADoC,CAEjDG,WAAW,CAAXA,WAFiD,CAGjDC,gBAAgB,CAAhBA,gBAHiD,CAA7C,C,yUAO0BF,K,6IAC1BzB,CAAAA,UAAU,CAACa,IAAX,yCAAiDY,KAAjD,E,sWAINI,K,CACAH,W,CACAC,gB,kJAEM3B,CAAAA,UAAU,CAACa,IAAX,CAAgB,gCAAhB,CAAkD,CACtDgB,KAAK,CAALA,KADsD,CAEtDjB,QAAQ,CAAEc,WAF4C,CAGtDI,aAAa,CAAEH,gBAHuC,CAAlD,C,0PAQV,MAAO,IAAMI,CAAAA,cAA8B,CAAG,GAAI5B,CAAAA,4BAAJ,EAAvC","sourcesContent":["import {AxiosResponse} from 'axios';\nimport {User} from '@instinct-prj/interface';\nimport {SessionService} from './Session.types';\nimport {backendAPI, setAPIToken} from '../../api';\nimport {localStorageService} from '../../services/local-storage';\n\nclass SessionServiceImplementation implements SessionService {\n  readonly localStorageKey = 'session';\n\n  async init(): Promise<User | undefined> {\n    try {\n      const authToken: string = localStorageService.get(this.localStorageKey);\n      return await this.attemptBearerToken(authToken);\n    } catch {\n      return undefined;\n    }\n  }\n\n  async attemptCredentials(\n    username: string,\n    password: string\n  ): Promise<string> {\n    const bearerToken: AxiosResponse<string> = await backendAPI.post(\n      'session',\n      {username, password}\n    );\n    return bearerToken.data;\n  }\n\n  async attemptBearerToken(bearerToken: string): Promise<User> {\n    try {\n      this.setBearerToken(bearerToken);\n      const session: AxiosResponse<User> = await backendAPI.get('session');\n      return session.data;\n    } catch {\n      setAPIToken();\n      throw new Error('Invalid bearer token');\n    }\n  }\n\n  setBearerToken(bearerToken: string): void {\n    setAPIToken(bearerToken);\n\n    return bearerToken !== undefined\n      ? localStorageService.set(this.localStorageKey, bearerToken)\n      : localStorageService.delete(this.localStorageKey);\n  }\n\n  async createSSO(): Promise<string> {\n    const sso: AxiosResponse<string> = await backendAPI.post('session/sso');\n    return sso.data;\n  }\n\n  async getCurrentUser(): Promise<User> {\n    try {\n      const user: AxiosResponse<User> = await backendAPI.get('session');\n      return user.data;\n    } catch {\n      throw new Error('Not Authenticated');\n    }\n  }\n\n  logout = () => {\n    localStorageService.delete(this.localStorageKey);\n  };\n\n  async updateProfile(favoriteYoutubeVideo: string): Promise<void> {\n    await backendAPI.post('session/settings/preferences', {\n      favoriteYoutubeVideo,\n    });\n  }\n\n  async updateEmail(currentPassword: string, newEmail: string): Promise<void> {\n    await backendAPI.post('session/settings/email', {\n      password: currentPassword,\n      email: newEmail,\n    });\n  }\n\n  async updatePassword(\n    currentPassword: string,\n    newPassword: string,\n    newPasswordAgain: string\n  ): Promise<void> {\n    await backendAPI.post('session/settings/password', {\n      oldPassword: currentPassword,\n      newPassword,\n      newPasswordAgain,\n    });\n  }\n\n  async generateForgotPasswordToken(email: string): Promise<void> {\n    await backendAPI.post(`session/forgot-password?email=${email}`);\n  }\n\n  async redeemForgotPasswordToken(\n    token: string,\n    newPassword: string,\n    newPasswordAgain: string\n  ): Promise<void> {\n    await backendAPI.post('session/forgot-password/redeem', {\n      token,\n      password: newPassword,\n      passwordAgain: newPasswordAgain,\n    });\n  }\n}\n\nexport const sessionService: SessionService = new SessionServiceImplementation();\n"]},"metadata":{},"sourceType":"module"}